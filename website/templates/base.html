<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>{% block title %}Home{% endblock %}</title>
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
      crossorigin="anonymous"
    />
    
    <!-- Main CSS -->
    <link rel="stylesheet" href="../static/assets/css/main.css" />
    <noscript><link rel="stylesheet" href="../static/assets/css/noscript.css" /></noscript>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.min.js" integrity="sha512-L0Shl7nXXzIlBSUUPpxrokqq4ojqgZFQczTYlGjzONGTDAcLremjwaWv5A+EDLnxhQzY5xUZPWLOLqYRkY0Cbw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
      <!-- Chatbox CSS -->
    <style>
      .chatbox {
          position: fixed;
          bottom: 0;
          right: 15px;
          width: 300px;
          border-radius: 10px 10px 0 0;
          background-color: #2c2c2c;
          box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
          z-index: 9999; /* Ensure the chatbox appears above other elements */
          font-family: Arial, sans-serif;
          font-size: 14px; /* Smaller font size */
      }

      .chatbox-header {
          padding: 15px;
          background-color: #333;
          color: white;
          border-radius: 10px 10px 0 0;
          display: flex;
          justify-content: space-between;
          align-items: center;
      }

      .chatbox-body {
        padding: 15px;
        display: none; /* Ensure the chatbox is closed by default */
        max-height: 300px;
        overflow-y: auto;
        background-color: #2c2c2c;
        display: flex;
        flex-direction: column;
    }

    .chatbox-footer {
        padding: 15px;
        background-color: #333;
        border-radius: 0 0 10px 10px;
        display: none; /* Ensure the chatbox is closed by default */
    }

    .chatbox input[type="text"] {
        
        padding: 10px;
        border: none;
        border-radius: 5px;
        margin-right: 10px;
    }

    .chatbox button {
        padding: 10px;
        border: none;
        border-radius: 5px;
        background-color: #4CAF50;
        color: white;
        width: 70px; /* Ensure consistent button width */
    }

      .chatbox-toggle {
          cursor: pointer;
      }

      .message {
          margin: 10px 0;
          padding: 8px 10px;
          border-radius: 5px;
          max-width: 80%;
          display: inline-block;
          word-wrap: break-word;
      }

      .message.user {
          text-align: right;
          background-color: #007bff;
          color: white;
          align-self: flex-end;
      }

      .message.bot {
          text-align: left;
          background-color: #f1f1f1;
          color: black;
          align-self: flex-start;
      }

      .sample-questions {
          margin-bottom: 10px;
      }

      .sample-questions p {
          margin: 5px 0;
          color: #aaa;
      }
    </style>
  </head>
  <body class="is-preload landing">
    <div id="page-wrapper">
      {% block header %}
      <!--<header id="header">
         <h1 id="logo"><a href="base.html">Hi {{ user.firstName }} {{ user.lastName }}</a></h1> 
        <nav id="nav">
          <ul>
            {% if user.is_authenticated %}
            <li><a href="/">Home</a></li>
            <li><a href="{{ url_for('views.preferences') }}">Preferences</a></li>
            <li><a href="/recommendation_page">Recommendation</a></li>
            -->
      <header id="header">
        <h1 id="logo"><a href="base.html">Hi Test!</a></h1>
        <nav id="nav">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="{{ url_for('views.preferences') }}">Preferences</a></li>
            <li><a href="/recommendation_page">Recommendation</a></li>
          <!--
            <li>
              <a href="#">Layouts</a>
              <ul>
                <li><a href="/recommendation_page">Recommendation</a></li>
                <li><a href="/keywordVisualize">Keyword</a></li>
                <li><a href="/leftSidebar">Left Sidebar</a></li>
              </ul>
            </li>
          -->
            <li><a href="/profile">Profile</a></li>
            <li><a id='logout' href="/logout" class="button primary">Logout</a></li>
            {% else %}
            <li><a id="login" href="/login">Login</a></li>
            <li><a id="signUp" href="/sign-up" class="button primary">Sign Up</a></li>
            {% endif %}
          </ul>
        </nav>
        {% with messages = get_flashed_messages(with_categories=true) %} {% if
          messages %} {% for category, message in messages %} {% if category ==
          'error' %}
          <div class="alert alert-danger alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="close" data-dismiss="alert">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          {% else %}
          <div class="alert alert-success alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="close" data-dismiss="alert">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          {% endif %} {% endfor %} {% endif %} {% endwith %}
      </header>
      {% endblock header %}
    
      {% block content %}
      <!-- Placeholder for content -->
      {% endblock content %}

      {% block footer %}
      <!-- Footer -->
      <footer id="footer">
        <ul class="icons">
            <li><a href="#" class="icon brands alt fa-twitter"><span class="label">Twitter</span></a></li>
            <li><a href="#" class="icon brands alt fa-facebook-f"><span class="label">Facebook</span></a></li>
            <li><a href="#" class="icon brands alt fa-linkedin-in"><span class="label">LinkedIn</span></a></li>
            <li><a href="#" class="icon brands alt fa-instagram"><span class="label">Instagram</span></a></li>
            <li><a href="#" class="icon brands alt fa-github"><span class="label">GitHub</span></a></li>
            <li><a href="#" class="icon solid alt fa-envelope"><span class="label">Email</span></a></li>
        </ul>
        <ul class="copyright">
            <li>&copy; Untitled. All rights reserved.</li>
            <li>Design: <a href='owner'>Aiman</a></li>
        </ul>
    </footer>
      {% endblock footer %}
    </div>

    <!-- Chatbox HTML -->
    <div class="chatbox">
      <div class="chatbox-header">
          <span>Chat with TechVerse Bot</span>
          <span class="chatbox-toggle"><i class="fas fa-chevron-up"></i></span>
      </div>
      <div class="chatbox-body"></div>
      <div class="chatbox-footer">
          <div class="sample-questions">
              <p>Try asking:</p>
              <p>- What is AWS?</p>
              <p>- How does PowerBI help in visualization?</p>
          </div>
          <input type="text" id="user_input" placeholder="Type your message here">
          <button id="send_button">Send</button>
      </div>
  </div>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

    {% block javascript %}
    <script src="../static/assets/js/formhandler.js"></script>
    <script src="../static/assets/js/jquery.min.js"></script>
    <script src="../static/assets/js/jquery.scrolly.min.js"></script>
    <script src="../static/assets/js/jquery.dropotron.min.js"></script>
    <script src="../static/assets/js/jquery.scrollex.min.js"></script>
    <script src="../static/assets/js/browser.min.js"></script>
    <script src="../static/assets/js/breakpoints.min.js"></script>
    <script src="../static/assets/js/util.js"></script>
    <script src="../static/assets/js/main.js"></script>

    <!-- Chatbox JavaScript -->
    <script>
      $(document).ready(function() {
          // Ensure the chatbox is closed by default
          $('.chatbox-body, .chatbox-footer').hide();
          $('.chatbox-toggle i').removeClass('fa-chevron-down').addClass('fa-chevron-up');

          // Toggle chatbox state
          $('.chatbox-toggle').click(function() {
              $('.chatbox-body, .chatbox-footer').toggle();
              $('.chatbox-toggle i').toggleClass('fa-chevron-up fa-chevron-down');
          });

          $('#send_button').click(function() {
              const userInput = $('#user_input').val();
              if (userInput.trim() === '') return;
              $('#user_input').val('');
              $('.chatbox-body').append(`<div class="message user">${userInput}</div>`);

              // Hide the sample questions after the first message is sent
              $('.sample-questions').hide();

              $.ajax({
                  url: '/chat',
                  method: 'POST',
                  contentType: 'application/json',
                  data: JSON.stringify({ message: userInput }),
                  success: function(data) {
                      $('.chatbox-body').append(`<div class="message bot">${data.response}</div>`);
                      $('.chatbox-body').scrollTop($('.chatbox-body')[0].scrollHeight);
                  },
                  error: function() {
                      $('.chatbox-body').append('<div class="message bot">An error occurred.</div>');
                  }
              });
          });

          $('#user_input').keypress(function(e) {
              if (e.which == 13) {
                  $('#send_button').click();
              }
          });
      });
    </script>
    {% endblock javascript %}

  </body>
</html>
